# Bugfix Note: plot_error_with_dim pattern handling

Date: 2025-08-27
Scope: Examples/GradProj_GPT2/plot_error_with_dim.py

## Summary
- Issue: The script expected a regex for `--results_pattern` and crashed with `re.error: nothing to repeat at position 0` when users supplied a shell-style glob like `'*min_4_seed_42_...'`.
- Root cause: `re.compile()` was called on a glob pattern beginning with `*`, which is invalid regex syntax.
- Fix: Added explicit glob support via `--pattern_type {regex,glob}` and improved error messaging when a glob is mistakenly passed as a regex.

## Changes
- CLI: New flag `--pattern_type` with choices `regex` (default) or `glob`.
- Behavior: If `pattern_type=glob`, the pattern is translated using `fnmatch.translate()` before regex compilation.
- Error handling: When `pattern_type=regex`, compilation errors now provide a clear hint if the input looks like a glob (contains `*`, `?`, `[`, `]`).
- Documentation: Updated Examples/GradProj_GPT2/README.md to reflect the new flag and corrected usage example.

## Validation
- Environment: Ran from repo root with existing Results folders.
- Command (regex pattern):
  - Verified the previous regex-based example still works unchanged.
- Command (glob pattern):
  ```bash
  python Examples/GradProj_GPT2/plot_error_with_dim.py \
    --results_dir Examples/GradProj_GPT2/Results \
    --results_pattern '*min_4_seed_42_dtype_bfloat16_row_on_False_emb_False' \
    --pattern_type glob \
    --num_ref 1 --max_iters 2 --reference rank=1024
  ```
  - Successfully discovered ranks {16,32,64,128,256,512,1024} and produced plots/json under `Examples/GradProj_GPT2/Plots/`.

## Notes
- For small `--max_iters` with `--num_ref` close to the number of loaded samples, variance/NaN warnings on `std()` can appear due to tiny sample sizes; increase `--max_iters` for stable statistics.
- When using `--reference full|full_layers`, ensure a `fullgrads*` directory exists under `--results_dir` (generated by `compute_full_gradients.py`).

